/*jslint indent: 4, maxerr: 50, white: true, node: true, stupid: true, sloppy: true */
/*global array_diff, array_flip */


function generateMissingTagsArticles() {
    var fs, path, php, MustacheComb, mustachio, directory,
        tmp, api, art, test, diff, mustacheTemplateParts,
        articleTemplate, extendedDoc;

    fs          = require('fs');
    path        = require('path');
    php         = require('phpjs').registerGlobals();
    MustacheComb= require('mustacheFunctions').MustacheComb;

    mustachio = new MustacheComb();

    directory = require('utilities').directory;

    function getFilenamePrefixTest(prefix) {
        return function test(file) {
            var out = false;
            if(file.indexOf(String(prefix)) === 0) {
                out = true;
            } else {
                out = false;
            }
            return out;
        };
    }

    api = {
        'dir' : 'Jake/API/describeTags',
        'list': []
    };
    art = {
        'dir'     : 'Jake/articles',
        'list'    : [],
        'missing' : []
    };

    // get the lists of files to compare.
    test     = getFilenamePrefixTest('tags-');
    api.list = directory.filterList(api.dir, test);
    art.list = directory.filterList(art.dir, test);
    // remove file extension
    api.list = api.list.map(function(e){
        return e.replace(/\.html/, '');
    });
    // get the difference between the two
    diff = array_diff(api.list, art.list);
    // flip keys for values
    diff = array_flip(diff);
    mustacheTemplateParts = {};
    for(tmp in diff) {
        if(diff.hasOwnProperty(tmp)) {
            mustachio.mustacheTagHandlers.tagName = tmp;
            mustachio.mustacheTagHandlers.tagBaseName = tmp.replace(/^tags-/,'');
            articleTemplate = mustachio.Mustache.to_html(mustachio.templates.tags, mustachio.mustacheTagHandlers, mustacheTemplateParts);
            fs.writeFileSync(path.join(art.dir, tmp), articleTemplate, 'utf8');
            extendedDoc = '<p>TODO: Finish Documentation</p>';
            fs.writeFileSync(path.join(art.dir, '../extended_docs/tags/' + tmp), extendedDoc, 'utf8');
        }
    }
    console.log('finished checking for missing tags articles.');
    console.dir(art.missing);
}
generateMissingTagsArticles();