/*jslint indent: 4, maxerr: 50, white: true, node: true, stupid: true */

/**
 * @file This file contains various utilities.
 * @author <a href="matthewkastor@gmail.com">Matthew Kastor</a>
 * @version 20121030
 * @requires fs
 * @requires path
 * @exports directory
 */

'use strict';

var fs, path, directory;

fs    = require('fs');
path  = require('path');

/**
 * Contains utilites used on directories.
 * @namespace
 */
directory = {};

/**
 * Filters a directory listing.
 * @function
 * @param {String} dir The directory to look in.
 * @param {Function} filt The filter function will be given each file's
 *  name. Filenames will be returned if the filter returns true for the
 *  given file name.
 * @returns {Array} Returns an array of file names based on the provided filter.
 */
directory.filterList = function filterList(dir, filt) {
    var filesArray;
    
    filesArray = [];
    
    dir = path.resolve(dir);
    try {
        fs.readdirSync(dir).forEach(function (file) {
            if (filt(file) === true) {
                filesArray.push(file);
            }
        });
    } catch(err) {
        console.log('There was an error accessing files.');
    }
    return filesArray;
};

/**
 * Deletes all html files in the specified directory.
 * @param {String} dir The directory to remove html files from.
 */
directory.purgeHtmlPages = function purgeHtmlPages(dir) {
    var remove;
    dir = path.resolve(dir);
    try {
        fs.readdirSync(dir).forEach(function (file) {
            if (/\.html$/.test(file)) {
                remove = path.join(dir, file);
                fs.unlinkSync(remove);
                console.log('File removed' + ' : ', remove);
            }
        });
    } catch(err) {
        console.log('There was an error when purging the HTML files.');
    }
};

exports.directory = directory;